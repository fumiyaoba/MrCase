{% extends "base.html" %}
{% block title %}案件一覧{% endblock %}

{% block content %}
<div class="page-header">
  <h1>案件一覧</h1>
  {% if request.user.is_staff or request.user.is_superuser %}
  <a href="{% url 'case_create' %}" class="btn btn-primary">＋ 新規案件</a>
  {% endif %}
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>ユニークキー</th>
        <th>案件名</th>
        <th>説明</th>
        <th>ステータス</th>
        <th>作成者</th>
        <th>作成日時</th>
        {% if request.user.is_staff or request.user.is_superuser %}
        <th>操作</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for c in cases %}
      <tr>
        <td style="color:#94a3b8">{{ c.id }}</td>
        <td>
          <div style="display:flex; align-items:center; gap:.4rem">
            <code style="background:#f1f5f9; padding:3px 8px; border-radius:6px; font-size:.9rem; letter-spacing:.05em">{{ c.unique_key }}</code>
            <button
              onclick="copyKey(this, '{{ c.unique_key }}')"
              style="border:none; background:none; cursor:pointer; color:#94a3b8; padding:2px 4px; border-radius:4px; transition:all .15s; line-height:0"
              onmouseover="this.style.color='#3b82f6'"
              onmouseout="this.style.color='#94a3b8'"
              title="コピー"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
          </div>
        </td>
        <td><strong>{{ c.name }}</strong></td>
        <td style="color:#64748b; max-width:280px">{{ c.description|truncatechars:60 }}</td>
        <td>
          {% if c.is_active %}
          <span class="tag tag-active">有効</span>
          {% else %}
          <span class="tag tag-inactive">無効</span>
          {% endif %}
        </td>
        <td>{{ c.created_by.username }}</td>
        <td style="color:#94a3b8; font-size:.85rem">{{ c.created_at|date:"Y/m/d H:i" }}</td>
        {% if request.user.is_staff or request.user.is_superuser %}
        <td>
          <a href="{% url 'case_edit' c.pk %}" class="btn btn-secondary btn-sm">編集</a>
          <a href="{% url 'case_delete' c.pk %}" class="btn btn-danger btn-sm">削除</a>
        </td>
        {% endif %}
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" style="text-align:center; color:#94a3b8; padding:2rem">案件がまだ登録されていません</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="copy-toast" style="display:none; position:fixed; bottom:2rem; right:2rem; background:#1e293b; color:#fff; padding:.6rem 1.2rem; border-radius:8px; font-size:.9rem; box-shadow:0 4px 12px rgba(0,0,0,.2)">
  コピーしました！
</div>

<script>
function copyKey(btn, key) {
  navigator.clipboard.writeText(key).then(() => {
    const toast = document.getElementById('copy-toast');
    toast.style.display = 'block';
    setTimeout(() => { toast.style.display = 'none'; }, 1500);
  });
}
</script>
{% endblock %}
